<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Student Awards Host</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; padding: 1rem; background: #f0f0f0; }
  label { display: block; margin-top: 1rem; }
  input, textarea { width: 100%; padding: 0.5rem; font-size: 1rem; }
  button { margin-top: 1rem; padding: 0.7rem 1.5rem; font-size: 1rem; cursor: pointer; }
  #linkOutput { margin-top: 1rem; word-break: break-all; background: #fff; padding: 1rem; border-radius: 4px; }
</style>
</head>
<body>

<h1>Student Awards - Host Menü</h1>

<label for="year">Jahr (z.B. 2025):</label>
<input type="number" id="year" value="2025" min="2000" max="2100" />

<label for="className">Klasse (z.B. 10b):</label>
<input type="text" id="className" placeholder="10b, 8c, ..." />

<label for="categories">Kategorien (kommagetrennt):</label>
<textarea id="categories" rows="2" placeholder="Lustig, Sportlich, ..."></textarea>

<label for="students">Schüler (Name, m/w; je eine pro Zeile, z.B. Max,m):</label>
<textarea id="students" rows="6" placeholder="Max,m&#10;Lena,w"></textarea>

<label for="deadline">Deadline (Datum für Ergebnis):</label>
<input type="date" id="deadline" />

<button id="createBtn">Tabelle erstellen & Links generieren</button>

<div id="linkOutput"></div>

<script>
  function generateCode() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let code = '';
    for(let i=0; i<5; i++) {
      code += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return code;
  }

  document.getElementById('createBtn').addEventListener('click', () => {
    const year = document.getElementById('year').value.trim();
    const className = document.getElementById('className').value.trim();
    const categoriesRaw = document.getElementById('categories').value.trim();
    const studentsRaw = document.getElementById('students').value.trim();
    const deadline = document.getElementById('deadline').value;

    if (!year || !className || !categoriesRaw || !studentsRaw || !deadline) {
      alert('Bitte alle Felder ausfüllen!');
      return;
    }

    const categories = categoriesRaw.split(',').map(s => s.trim()).filter(s => s);
    if (categories.length === 0) {
      alert('Bitte mindestens eine Kategorie angeben!');
      return;
    }

    const studentLines = studentsRaw.split('\n').map(s => s.trim()).filter(s => s);
    if (studentLines.length === 0) {
      alert('Bitte mindestens einen Schüler angeben!');
      return;
    }

    const students = [];
    for (const line of studentLines) {
      const parts = line.split(',');
      if(parts.length !== 2) {
        alert('Schüler müssen im Format "Name,m" oder "Name,w" eingegeben werden!');
        return;
      }
      const name = parts[0].trim();
      const gender = parts[1].trim().toLowerCase();
      if(!name || (gender !== 'm' && gender !== 'w')) {
        alert('Schüler müssen im Format "Name,m" oder "Name,w" eingegeben werden!');
        return;
      }
      students.push({name, gender});
    }

    const code = generateCode();

    // Daten speichern mit leerem votes und voted Array
    const data = { year, className, categories, students, deadline, votes: {}, voted: [] };

    localStorage.setItem(code, JSON.stringify(data));

    // Generierte Links
    const voteLink = `${location.origin}${location.pathname.replace('index.html','vote.html')}?code=${code}`;
    const resultLink = `${location.origin}${location.pathname.replace('index.html','result.html')}?code=${code}`;

    const linkOutput = document.getElementById('linkOutput');
    linkOutput.innerHTML = `
      <p><strong>Link für die Abstimmung (Schüler):</strong><br><a href="${voteLink}" target="_blank">${voteLink}</a></p>
      <p><strong>Link für die Ergebnisansicht (Host, nach Deadline):</strong><br><a href="${resultLink}" target="_blank">${resultLink}</a></p>
      <p><strong>Abstimmungscode:</strong> ${code}</p>
    `;
  });
</script>

</body>
</html>
